<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>11. case</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="puzzle-style.css">
    
    <style>
        /* Specific styles for Feed the Yeti */
        #game-ui {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .status-log {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            width: 100%;
            height: 120px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            text-align: left;
            box-sizing: border-box;
            color: #ddd;
        }

        .log-entry { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 2px;}
        .warning-text { color: #ffeb3b; font-weight: bold; }
        .danger-text { color: #ff6b6b; font-weight: bold; }
        .success-text { color: #69f0ae; font-weight: bold; }

        .room-display {
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-family: 'Cinzel', serif;
            color: #f6d365;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            transition: all 0.2s;
        }
        .control-btn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.05); }
        .control-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none; }

        .action-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 30px;
        }

        .toggle-opt {
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
            text-transform: uppercase;
            font-weight: bold;
        }
        .toggle-opt.active { background: #f6d365; color: #1b2735; }
        .toggle-opt:not(.active) { color: #aaa; }

        /* Map Visualizer (Simple) */
        .mini-map {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            margin-top: 20px;
            opacity: 0.7;
        }
        .map-cell {
            width: 15px; height: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }
        .map-cell.visited { background: rgba(255,255,255,0.4); }
        .map-cell.current { background: #f6d365; box-shadow: 0 0 5px #f6d365; }

    </style>
</head>
<body>
    <canvas id="snow-canvas"></canvas>
    
    <div class="container">
        <div class="puzzle-box">
            <h1>Puzzle 11: Feed the Yeti</h1>
            <p class="instructions">
                Navigate the ice caves to find the hungry Yeti. <br>
                <strong>Chill</strong> = Slush Puddle nearby. <strong>Wings</strong> = Bats nearby. <strong>Rumble</strong> = Hungry Yeti nearby.<br>
                Toss a treat into the Yeti's room to make a friend!
            </p>
            
            <div id="game-ui">
                <div class="room-display" id="room-indicator">Cave Entrance</div>
                
                <div class="status-log" id="game-log">
                    <div class="log-entry">You enter the frozen caverns with a bag of snacks...</div>
                </div>

                <div class="action-toggle">
                    <div class="toggle-opt active" id="mode-move" onclick="setMode('move')">Move</div>
                    <div class="toggle-opt" id="mode-shoot" onclick="setMode('shoot')">Toss Snack</div>
                </div>

                <div class="controls-grid">
                    <div></div>
                    <button class="control-btn" id="btn-n" onclick="handleAction('N')">N</button>
                    <div></div>
                    <button class="control-btn" id="btn-w" onclick="handleAction('W')">W</button>
                    <div style="display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5rem;">üç™</div>
                    <button class="control-btn" id="btn-e" onclick="handleAction('E')">E</button>
                    <div></div>
                    <button class="control-btn" id="btn-s" onclick="handleAction('S')">S</button>
                    <div></div>
                </div>

                <div class="mini-map" id="mini-map"></div>
            </div>

            <!-- Success/Fail Modals -->
            <div id="ui-layer" class="ui-layer hidden-ui">
                <div id="win-screen" style="display:none;">
                    <div class="game-msg">Friend Made!</div>
                    <p style="margin-bottom: 20px; font-size: 1.1rem;">The Yeti loves the snack.</p>
                    <button class="btn-style" id="next-level-btn" onclick="goToNextLevel()">Proceed</button>
                </div>
                <div id="lose-screen" style="display:none;">
                    <div class="game-msg" style="color: #ff6b6b;" id="death-msg">Oh no!</div>
                    <button class="btn-style" onclick="initGame()">Try Again</button>
                </div>
            </div>
        </div>

        <div class="spacer-medium"></div>
        <div class="hidden-clue">11. case</div>
    </div>

    <script>
        const GRID_W = 5;
        const GRID_H = 5;
        let playerPos = {x:0, y:0};
        let startPos = {x:0, y:0};
        let yetiPos, pitPos1, pitPos2, batPos1, batPos2;
        let visited = [];
        let actionMode = 'move'; // 'move' or 'shoot'
        let gameActive = true;

        function initGame() {
            gameActive = true;
            visited = [];
            // Generate Random Positions (ensure no overlap on start)
            startPos = { x: Math.floor(Math.random()*GRID_W), y: Math.floor(Math.random()*GRID_H) };
            playerPos = {...startPos};
            
            let positions = [startPos];
            const getRandPos = () => {
                let p;
                do { p = { x: Math.floor(Math.random()*GRID_W), y: Math.floor(Math.random()*GRID_H) }; } 
                while (positions.some(pos => pos.x === p.x && pos.y === p.y));
                positions.push(p);
                return p;
            };

            yetiPos = getRandPos();
            pitPos1 = getRandPos();
            pitPos2 = getRandPos();
            batPos1 = getRandPos();
            batPos2 = getRandPos();

            // UI Reset
            document.getElementById('game-log').innerHTML = '<div class="log-entry">You enter the frozen caverns...</div>';
            document.getElementById('ui-layer').classList.add('hidden-ui');
            document.getElementById('ui-layer').classList.remove('active-ui');
            document.getElementById('win-screen').style.display = 'none';
            document.getElementById('lose-screen').style.display = 'none';
            setMode('move');
            updateState();
        }

        function setMode(mode) {
            actionMode = mode;
            document.getElementById('mode-move').className = mode === 'move' ? 'toggle-opt active' : 'toggle-opt';
            document.getElementById('mode-shoot').className = mode === 'shoot' ? 'toggle-opt active' : 'toggle-opt';
        }

        function handleAction(dir) {
            if (!gameActive) return;
            
            let target = { ...playerPos };
            if (dir === 'N') target.y--;
            if (dir === 'S') target.y++;
            if (dir === 'E') target.x++;
            if (dir === 'W') target.x--;

            // Bounds Check
            if (target.x < 0 || target.x >= GRID_W || target.y < 0 || target.y >= GRID_H) {
                log("That path is blocked by ice.", "warning-text");
                return;
            }

            if (actionMode === 'move') {
                playerPos = target;
                checkRoom();
            } else {
                // Tossing Snack
                if (target.x === yetiPos.x && target.y === yetiPos.y) {
                    gameWin();
                } else {
                    log("You tossed a snack... but nobody was there.", "warning-text");
                    log("You hear the Yeti moving around!", "danger-text");
                    moveYeti();
                }
                setMode('move'); // Reset to move after shot
            }
        }

        function moveYeti() {
            // Yeti moves to a random adjacent cell (if valid)
            const moves = [{x:0, y:-1}, {x:0, y:1}, {x:1, y:0}, {x:-1, y:0}];
            const validMoves = moves.map(m => ({x: yetiPos.x + m.x, y: yetiPos.y + m.y}))
                                    .filter(p => p.x >= 0 && p.x < GRID_W && p.y >= 0 && p.y < GRID_H);
            if (validMoves.length > 0) {
                yetiPos = validMoves[Math.floor(Math.random() * validMoves.length)];
                // If Yeti moves onto player
                if (yetiPos.x === playerPos.x && yetiPos.y === playerPos.y) {
                    gameOver("The Yeti bumped into you! You dropped your snacks.");
                } else {
                    updateState(); // Re-check warnings
                }
            }
        }

        function checkRoom() {
            // 1. Check Hazards
            if (isSame(playerPos, yetiPos)) {
                gameOver("You startled the Yeti! He ran away.");
                return;
            }
            if (isSame(playerPos, pitPos1) || isSame(playerPos, pitPos2)) {
                gameOver("Splash! You fell in a slush puddle. Gross.");
                return;
            }
            if (isSame(playerPos, batPos1) || isSame(playerPos, batPos2)) {
                log("Friendly bats carry you to a new room!", "warning-text");
                // Move player randomly
                playerPos = { x: Math.floor(Math.random()*GRID_W), y: Math.floor(Math.random()*GRID_H) };
                checkRoom(); // Recursive check for new room
                return;
            }

            // 2. Safe Room - Mark visited & Show Warnings
            if (!visited.some(p => isSame(p, playerPos))) visited.push(playerPos);
            updateState();
        }

        function updateState() {
            renderMap();
            let warnings = [];
            
            // Check adjacency
            const adj = getNeighbors(playerPos);
            
            if (adj.some(p => isSame(p, yetiPos))) warnings.push("<span class='danger-text'>You hear a tummy rumble...</span>");
            if (adj.some(p => isSame(p, pitPos1) || isSame(p, pitPos2))) warnings.push("<span class='warning-text'>You feel a cold draft...</span>");
            if (adj.some(p => isSame(p, batPos1) || isSame(p, batPos2))) warnings.push("<span class='warning-text'>You hear flapping wings...</span>");

            if (warnings.length > 0) {
                warnings.forEach(w => log(w));
            } else {
                log("The cave is silent.");
            }
            
            document.getElementById('room-indicator').innerText = `Room ${playerPos.x},${playerPos.y}`;
        }

        function getNeighbors(p) {
            return [
                {x: p.x, y: p.y-1}, {x: p.x, y: p.y+1},
                {x: p.x-1, y: p.y}, {x: p.x+1, y: p.y}
            ];
        }

        function isSame(p1, p2) { return p1.x === p2.x && p1.y === p2.y; }

        function log(msg, cls='') {
            const el = document.getElementById('game-log');
            el.innerHTML += `<div class="log-entry ${cls}">${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        function renderMap() {
            const map = document.getElementById('mini-map');
            map.innerHTML = '';
            for(let y=0; y<GRID_H; y++) {
                for(let x=0; x<GRID_W; x++) {
                    const d = document.createElement('div');
                    d.className = 'map-cell';
                    if (x === playerPos.x && y === playerPos.y) d.classList.add('current');
                    else if (visited.some(p => p.x === x && p.y === y)) d.classList.add('visited');
                    map.appendChild(d);
                }
            }
        }

        function gameOver(reason) {
            gameActive = false;
            document.getElementById('death-msg').innerText = reason;
            const ui = document.getElementById('ui-layer');
            ui.classList.remove('hidden-ui'); ui.classList.add('active-ui');
            document.getElementById('lose-screen').style.display = 'flex';
        }

        function gameWin() {
            gameActive = false;
            const ui = document.getElementById('ui-layer');
            ui.classList.remove('hidden-ui'); ui.classList.add('active-ui');
            document.getElementById('win-screen').style.display = 'flex';
        }

        const _next = [49, 50, 45, 111, 117, 116, 100, 111, 111, 114, 46, 104, 116, 109, 108]; // 12-outdoor.html
        function goToNextLevel() {
            const url = String.fromCharCode(..._next);
            try { if (window.location.protocol === 'blob:') throw new Error("Restricted"); window.location.href = url; } 
            catch (e) { 
                const btn = document.getElementById('next-level-btn'); btn.innerHTML = "Opening..."; 
                const a = document.createElement('a'); a.href = url; a.innerText = "Click here"; a.style.color="#333"; a.style.display="block"; 
                btn.parentNode.appendChild(a); a.click(); 
            }
        }

        /* --- SNOW ANIMATION (Harmonized) --- */
        const canvas = document.getElementById("snow-canvas");
        const ctx = canvas.getContext("2d");
        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        const particles = [];
        const particleCount = 100;

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.radius = Math.random() * 3 + 1;
                this.speedY = Math.random() * 1 + 0.5;
                this.speedX = Math.random() * 0.5 - 0.25;
                this.opacity = Math.random() * 0.5 + 0.3;
            }
            update() {
                this.y += this.speedY;
                this.x += this.speedX;
                if (this.y > height) this.y = 0;
                if (this.x > width) this.x = 0;
                if (this.x < 0) this.x = width;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.fill();
            }
        }

        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animate);
        }
        animate();

        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        });

        initGame();
    </script>
</body>
</html>
