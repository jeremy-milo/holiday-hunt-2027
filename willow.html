<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poodle Winter Dash</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* Parallax Layers */
        .layer {
            position: absolute;
            width: 100%;
            height: 100%;
            background-repeat: repeat-x;
            will-change: background-position;
        }

        #mountains {
            bottom: 100px;
            height: 300px;
            background-size: auto 100%;
            z-index: 1;
            opacity: 0.8;
        }

        #houses-trees {
            bottom: 60px;
            height: 200px;
            background-size: auto 100%;
            z-index: 2;
        }

        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: #fff;
            border-top: 4px solid #ddd;
            z-index: 3;
        }

        /* Game Objects */
        #poodle {
            position: absolute;
            bottom: 60px;
            left: 50px;
            width: 50px;
            height: 50px;
            z-index: 10;
        }

        .obstacle {
            position: absolute;
            bottom: 60px;
            width: 40px;
            height: 40px;
            z-index: 9;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            font-size: 30px;
        }
        
        .pit {
            bottom: 0px !important;
            height: 60px;
            background: #87CEEB; /* Sky color to look like a hole */
            border-left: 2px solid #ccc;
            border-right: 2px solid #ccc;
            z-index: 4;
        }

        #finish-line {
            position: absolute;
            bottom: 60px;
            width: 20px;
            height: 200px;
            background: repeating-linear-gradient(
                45deg,
                #fff,
                #fff 10px,
                #000 10px,
                #000 20px
            );
            z-index: 5;
            display: none; /* Hidden until near end */
        }

        /* UI */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        #start-screen, #game-over-screen, #win-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #333;
            z-index: 200;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }

        button:hover {
            background: #45a049;
        }

        /* Fireworks Canvas */
        #fireworks {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 150;
            pointer-events: none;
        }

        .hidden { display: none !important; }

    </style>
</head>
<body>

<div id="game-container">
    <!-- Backgrounds drawn via Canvas or CSS gradients/shapes -->
    <div id="mountains" class="layer"></div>
    <div id="houses-trees" class="layer"></div>
    <div id="ground"></div>

    <div id="poodle">
        <!-- SVG Poodle -->
        <svg viewBox="0 0 100 100" width="100%" height="100%">
            <!-- Body -->
            <ellipse cx="50" cy="60" rx="25" ry="15" fill="#8B4513" />
            <!-- Head -->
            <circle cx="70" cy="40" r="12" fill="#8B4513" />
            <!-- Poodle puffs (Head) -->
            <circle cx="70" cy="32" r="8" fill="#A0522D" />
            <!-- Poodle puffs (Tail) -->
            <circle cx="25" cy="50" r="6" fill="#A0522D" />
            <!-- Legs -->
            <rect x="35" y="70" width="6" height="15" fill="#8B4513" />
            <rect x="60" y="70" width="6" height="15" fill="#8B4513" />
            <!-- Puffs (Feet) -->
            <circle cx="38" cy="85" r="5" fill="#A0522D" />
            <circle cx="63" cy="85" r="5" fill="#A0522D" />
            <!-- Eye/Nose -->
            <circle cx="75" cy="38" r="2" fill="black" />
            <circle cx="82" cy="40" r="2" fill="black" />
            <!-- Ear -->
            <ellipse cx="62" cy="45" rx="5" ry="10" fill="#654321" />
        </svg>
    </div>

    <div id="finish-line"></div>
    <canvas id="fireworks"></canvas>

    <div id="ui-layer">Distance: <span id="score">0</span>m</div>

    <div id="start-screen">
        <h1>Poodle Winter Dash</h1>
        <p>Spacebar or Tap to Jump</p>
        <button onclick="startGame()">Start Run</button>
    </div>

    <div id="game-over-screen" class="hidden">
        <h1>Ouch!</h1>
        <p>You hit an obstacle.</p>
        <button onclick="resetGame()">Try Again</button>
    </div>

    <div id="win-screen" class="hidden">
        <h1>Good Girl!</h1>
        <p>You reached the finish line!</p>
        <button onclick="resetGame()">Play Again</button>
    </div>
</div>

<script>
    // --- Configuration ---
    const GAME_SPEED_START = 8;
    const JUMP_FORCE = 18; // Increased slightly
    const GRAVITY = 0.8;
    const FINISH_DISTANCE = 2000; // Pixels to travel
    
    // --- State ---
    let gameActive = false;
    let gameSpeed = GAME_SPEED_START;
    let distanceTraveled = 0;
    let score = 0;
    let obstacles = [];
    let poodleY = 0;
    let velocityY = 0;
    let isJumping = false;
    let animationFrameId;
    let obstacleTimer = 0;
    let stepTimer = 0;

    // --- DOM Elements ---
    const poodleEl = document.getElementById('poodle');
    const mountainsEl = document.getElementById('mountains');
    const housesEl = document.getElementById('houses-trees');
    const finishLineEl = document.getElementById('finish-line');
    const scoreEl = document.getElementById('score');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const winScreen = document.getElementById('win-screen');
    const gameContainer = document.getElementById('game-container');
    const fireworksCanvas = document.getElementById('fireworks');
    const ctxFireworks = fireworksCanvas.getContext('2d');

    // --- Audio Context ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    // --- Procedural Background Generation (CSS Gradients/SVG) ---
    function generateBackgrounds() {
        // Mountains
        const mountainSVG = `
            <svg xmlns='http://www.w3.org/2000/svg' width='800' height='300' viewBox='0 0 800 300'>
                <path d='M0,300 L150,100 L300,300 L450,50 L600,300 L800,200 L800,300 Z' fill='#A9A9A9' />
                <path d='M150,100 L180,150 L120,150 Z' fill='white' /> <!-- Snow cap -->
                <path d='M450,50 L500,120 L400,120 Z' fill='white' /> <!-- Snow cap -->
            </svg>`;
        mountainsEl.style.backgroundImage = `url("data:image/svg+xml,${encodeURIComponent(mountainSVG)}")`;

        // Houses and Trees
        const houseTreeSVG = `
            <svg xmlns='http://www.w3.org/2000/svg' width='600' height='200' viewBox='0 0 600 200'>
                <!-- Tree -->
                <polygon points='50,200 100,100 150,200' fill='#228B22' />
                <polygon points='75,100 100,50 125,100' fill='#228B22' /> 
                <!-- House -->
                <rect x='200' y='120' width='80' height='80' fill='#B22222' />
                <polygon points='190,120 240,70 290,120' fill='#fff' stroke='#333' stroke-width='2'/>
                <rect x='230' y='160' width='20' height='40' fill='#654321' />
                <!-- Tree -->
                <polygon points='400,200 450,100 500,200' fill='#228B22' />
                <polygon points='425,100 450,50 475,100' fill='#228B22' />
            </svg>`;
        housesEl.style.backgroundImage = `url("data:image/svg+xml,${encodeURIComponent(houseTreeSVG)}")`;
    }
    generateBackgrounds();

    // --- Sound Synthesis ---
    function playBark() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(600, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    function playStep() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine'; // Softer sound for snow
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
    }

    function playExplosionSound() {
        // Simple noise burst for fireworks
        const bufferSize = audioCtx.sampleRate * 0.5;
        const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            data[i] = Math.random() * 2 - 1;
        }
        const noise = audioCtx.createBufferSource();
        noise.buffer = buffer;
        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        noise.connect(gain);
        gain.connect(audioCtx.destination);
        noise.start();
    }

    // --- Game Logic ---

    function jump() {
        if (!isJumping && gameActive) {
            isJumping = true;
            velocityY = JUMP_FORCE;
            playBark();
        }
    }

    function spawnObstacle() {
        const type = Math.random();
        const obs = document.createElement('div');
        obs.classList.add('obstacle');
        
        // Data for collision logic
        let obsData = { el: obs, x: window.innerWidth, type: 'normal', width: 40, height: 40 };

        if (type < 0.33) {
            // Log
            obs.style.width = '60px';
            obs.style.height = '20px';
            obs.style.background = '#5D4037';
            obs.style.borderRadius = '10px';
            obsData.width = 60;
            obsData.height = 20;
        } else if (type < 0.66) {
            // Stump
            obs.style.width = '30px';
            obs.style.height = '40px';
            obs.style.background = '#795548';
            obsData.width = 30;
            obsData.height = 40;
        } else {
            // Pit
            obs.classList.add('pit');
            obs.style.width = '80px';
            obsData.type = 'pit';
            obsData.width = 80;
            obsData.height = 10; // Hitbox is low
        }

        gameContainer.appendChild(obs);
        obstacles.push(obsData);
    }

    function update() {
        if (!gameActive) return;

        // Gravity
        if (isJumping) {
            poodleY += velocityY;
            velocityY -= GRAVITY;
            if (poodleY <= 0) {
                poodleY = 0;
                isJumping = false;
                velocityY = 0;
            }
        }
        poodleEl.style.bottom = (60 + poodleY) + 'px';

        // Footsteps sound
        if (!isJumping) {
            stepTimer++;
            if (stepTimer > 15 - (gameSpeed/2)) { // Faster steps when faster speed
                playStep();
                stepTimer = 0;
            }
        }

        // Move Backgrounds (Parallax)
        let mountainPos = parseFloat(getComputedStyle(mountainsEl).backgroundPositionX) || 0;
        let housePos = parseFloat(getComputedStyle(housesEl).backgroundPositionX) || 0;
        
        mountainsEl.style.backgroundPositionX = (mountainPos - (gameSpeed * 0.2)) + 'px';
        housesEl.style.backgroundPositionX = (housePos - (gameSpeed * 0.6)) + 'px';

        // Obstacle Spawning
        obstacleTimer++;
        if (obstacleTimer > (Math.random() * 60 + 60) && distanceTraveled < FINISH_DISTANCE - 500) {
            spawnObstacle();
            obstacleTimer = 0;
        }

        // Move Obstacles & Collision
        for (let i = obstacles.length - 1; i >= 0; i--) {
            let obs = obstacles[i];
            obs.x -= gameSpeed;
            obs.el.style.left = obs.x + 'px';

            // Remove off-screen
            if (obs.x < -100) {
                obs.el.remove();
                obstacles.splice(i, 1);
                continue;
            }

            // Collision Detection
            // Poodle Hitbox: Left 50px, Width 50px. Bottom depends on Jump.
            // Poodle X range: 50 to 100.
            
            // Check X overlap
            if (obs.x < 90 && obs.x + obs.width > 60) {
                // Check Y overlap
                // Pit logic: You fall IN if you are on the ground
                if (obs.type === 'pit') {
                    if (poodleY < 10) { // If low to ground
                        gameOver();
                    }
                } else {
                    // Standard obstacle: Hit if poodle bottom is lower than obstacle height
                    if (poodleY < obs.height) {
                        gameOver();
                    }
                }
            }
        }

        // Progress
        distanceTraveled += gameSpeed;
        score = Math.floor(distanceTraveled / 10);
        scoreEl.innerText = score;

        // Finish Line Logic
        if (distanceTraveled >= FINISH_DISTANCE) {
            finishLineEl.style.display = 'block';
            let finishX = (distanceTraveled - FINISH_DISTANCE) * -1 + window.innerWidth;
            finishLineEl.style.left = finishX + 'px';

            if (finishX < 50) {
                winGame();
            }
        }

        animationFrameId = requestAnimationFrame(update);
    }

    function startGame() {
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        winScreen.classList.add('hidden');
        
        // Reset Variables
        gameActive = true;
        distanceTraveled = 0;
        score = 0;
        poodleY = 0;
        velocityY = 0;
        isJumping = false;
        obstacles.forEach(o => o.el.remove());
        obstacles = [];
        finishLineEl.style.display = 'none';
        
        // Start Loop
        update();
    }

    function resetGame() {
        // Clear fireworks
        ctxFireworks.clearRect(0,0, fireworksCanvas.width, fireworksCanvas.height);
        startGame();
    }

    function gameOver() {
        gameActive = false;
        cancelAnimationFrame(animationFrameId);
        gameOverScreen.classList.remove('hidden');
    }

    function winGame() {
        gameActive = false;
        cancelAnimationFrame(animationFrameId);
        winScreen.classList.remove('hidden');
        launchFireworks();
    }

    // --- Fireworks System ---
    function launchFireworks() {
        fireworksCanvas.width = window.innerWidth;
        fireworksCanvas.height = window.innerHeight;
        
        let particles = [];
        
        function createParticle(x, y, color) {
            return {
                x: x, y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                alpha: 1,
                color: color
            };
        }

        function boom() {
            playExplosionSound();
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * (window.innerHeight / 2);
            const color = `hsl(${Math.random() * 360}, 100%, 50%)`;
            
            for(let i=0; i<50; i++) {
                particles.push(createParticle(x, y, color));
            }
        }

        // Initial Booms
        boom();
        setTimeout(boom, 300);
        setTimeout(boom, 600);
        setTimeout(boom, 900);

        function updateFireworks() {
            if (gameActive) return; // Stop if restarted
            
            ctxFireworks.globalCompositeOperation = 'destination-out';
            ctxFireworks.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctxFireworks.fillRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
            ctxFireworks.globalCompositeOperation = 'lighter';

            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1; // Gravity
                p.alpha -= 0.01;
                
                ctxFireworks.fillStyle = p.color;
                ctxFireworks.globalAlpha = p.alpha;
                ctxFireworks.beginPath();
                ctxFireworks.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctxFireworks.fill();

                if (p.alpha <= 0) particles.splice(i, 1);
            }

            if (particles.length > 0) {
                requestAnimationFrame(updateFireworks);
            }
        }
        updateFireworks();
    }

    // --- Input Handling ---
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' || e.code === 'ArrowUp') {
            jump();
        }
    });

    window.addEventListener('touchstart', (e) => {
        jump();
    });

    window.addEventListener('mousedown', (e) => {
        jump();
    });

</script>
</body>
</html>
